<!-- Modern Layout with Dynamic SEO - Centralizes all SEO meta tag generation-->
<!-- Uses articles.json data to automatically populate title, description, keywords-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Essential Meta Tags-->
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="color-scheme" content="light dark" />
        <!-- Theme color for supported browsers (Chrome, Safari, Edge)-->
        <meta name="theme-color" content="#2c3e50" media="(prefers-color-scheme: light)" />
        <meta name="theme-color" content="#34495e" media="(prefers-color-scheme: dark)" />
        <!-- Dynamic SEO Meta Tags from articles.json-->
        <title>Fixing Node.js Recursive Folder Issue</title>
        <meta name="description" content="Discover how to fix a Node.js bug causing endless recursive directories and learn a C++ solution for effective cleanup. Explore preventive measures." />
        <meta name="keywords" content="Node.js, recursive directories, C++ cleanup, Mark Hazleton, programming, software development" />
        <meta name="author" content="Mark Hazleton" />
        <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
        <!-- Page-specific metadata block (optional overrides)-->
        <!-- Canonical URL-->
        <link rel="canonical" href="https://markhazleton.com/articles/fixing-a-runaway-nodejs-recursive-folder-issue.html" />
        <!-- Default canonical override block (for backward compatibility)-->
        <!-- Open Graph Meta Tags - Optimized for LinkedIn Sharing-->
        <meta property="og:title" content="Fixing a Runaway Node.js Recursive Folder Issue" />
        <meta property="og:description" content="Discover how to fix a Node.js bug causing endless recursive directories and learn a C++ solution for effective cleanup. Explore preventive measures." />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://markhazleton.com/articles/fixing-a-runaway-nodejs-recursive-folder-issue.html" />
        <meta property="og:image" content="https://markhazleton.com/assets/img/MurdoHighlandCoo.jpg" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content="Fixing a Runaway Node.js Recursive Folder Issue - Mark Hazleton" />
        <meta property="og:site_name" content="Mark Hazleton" />
        <meta property="og:locale" content="en_US" />
        <!-- LinkedIn-specific optimizations-->
        <meta property="article:author" content="Mark Hazleton" />
        <meta property="article:published_time" content="2024-10-03" />
        <meta property="article:tag" content="Mark Hazleton" />
        <meta property="article:tag" content="recursive folders" />
        <meta property="article:tag" content="C++ solution" />
        <meta property="article:tag" content="Windows path limitations" />
        <meta property="article:tag" content="WIN32 API" />
        <!-- YouTube video Open Graph tags-->
        <!-- Additional Open Graph overrides (for backward compatibility)-->
        <!-- Twitter Card Meta Tags-->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@markhazleton" />
        <meta name="twitter:creator" content="@markhazleton" />
        <meta name="twitter:title" content="Fixing Node.js Folder Issue" />
        <meta name="twitter:description" content="Discover how to fix a Node.js bug causing endless recursive directories and learn a C++ solution for effective cleanup. Explore preventive measures." />
        <meta name="twitter:image" content="https://markhazleton.com/assets/img/MurdoHighlandCoo.jpg" />
        <meta name="twitter:image:alt" content="Fixing a Runaway Node.js Recursive Folder Issue - Mark Hazleton" />
        <!-- YouTube video Twitter Card tags-->
        <!-- Additional Twitter Card overrides (for backward compatibility)-->
        <!-- Performance optimization - No external CDN dependencies-->
        <!-- Favicon and app icons-->
        <link rel="shortcut icon" href="/assets/img/favicon.ico" />
        <link rel="icon" type="image/x-icon" href="/assets/img/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
        <link rel="manifest" href="/site.webmanifest" />
        <!-- Modern Layout Styles (includes Bootstrap 5, Bootstrap Icons, Font Awesome, PrismJS)-->
        <link href="/css/modern-styles.css" rel="stylesheet" />
        <!-- Enhanced JSON-LD Structured Data for SEO-->
        <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "Person",
                "name": "Mark Hazleton",
                "givenName": "Mark",
                "familyName": "Hazleton",
                "jobTitle": "Solutions Architect",
                "description": "Solutions Architect passionate for solutions which make technology work for business",
                "url": "https://markhazleton.com",
                "image": {
                    "@type": "ImageObject",
                    "url": "https://markhazleton.com/assets/img/MarkHazleton.jpg",
                    "width": 400,
                    "height": 400
                },
                "sameAs": ["https://www.linkedin.com/in/markhazleton/", "https://github.com/markhazleton/", "https://twitter.com/markhazleton/", "https://www.youtube.com/@MarkHazleton"],
                "knowsAbout": [".NET Framework", "ASP.NET Core", "Microsoft Azure", "Project Management", "Web Development", "Solution Architecture", "Software Engineering", "Cloud Computing", "Artificial Intelligence", "Machine Learning"],
                "alumniOf": {
                    "@type": "Organization",
                    "name": "University of North Texas"
                },
                "address": {
                    "@type": "PostalAddress",
                    "addressLocality": "Wichita",
                    "addressRegion": "KS",
                    "addressCountry": "US"
                },
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": "https://markhazleton.com/"
                }
            }
        </script>
        <!-- Additional structured data for specific pages-->
        <!-- Additional page-specific CSS-->
        <!-- Include LinkedIn sharing mixins-->
        <!-- Global site tag (gtag.js) - Google Analytics-->
        <script src="https://www.googletagmanager.com/gtag/js?id=G-L8GVZNDH0B" async></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'G-L8GVZNDH0B');
        </script>
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" role="navigation" aria-label="Main navigation">
            <div class="container-fluid">
                <a class="navbar-brand" href="/#" aria-label="Mark Hazleton homepage">Mark Hazleton</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link active" href="/#about" aria-current="page">About Mark</a></li>
                        <li class="nav-item"><a class="nav-link" href="/#experience">Experience & Credentials</a></li>
                        <li class="nav-item"><a class="nav-link" href="/#projects">Solutions & Tools</a></li>
                        <li class="nav-item"><a class="nav-link" href="/articles.html">Insights & Articles</a></li>
                        <li class="nav-item"><a class="nav-link" href="/#contact">Contact</a></li>
                    </ul>
                    <!-- Search Box - Inside collapsible navbar-->
                    <form class="d-flex me-3 my-2 my-lg-0" onsubmit="return searchArticles(event)">
                        <div class="input-group search-box">
                            <input class="form-control" id="headerSearchInput" type="search" placeholder="Search articles..." aria-label="Search articles" autocomplete="off" />
                            <button class="btn btn-outline-light" type="submit" aria-label="Search"><i class="fas fa-search"></i></button>
                        </div>
                    </form>
                    <!-- Social Icons - Inside collapsible navbar-->
                    <div class="d-flex social-icons">
                        <a href="https://www.linkedin.com/in/markhazleton/" target="_blank" rel="noopener noreferrer" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="https://github.com/markhazleton/" target="_blank" rel="noopener noreferrer" title="GitHub"><i class="fab fa-github"></i></a>
                        <a href="https://www.youtube.com/@MarkHazleton" target="_blank" rel="noopener noreferrer" title="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
        </nav>
        <br />
        <br />
        <!-- Hero Section-->
        <section class="bg-gradient-primary py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-10 mx-auto text-center">
                        <h1 class="display-4 fw-bold mb-3">
                            <i class="bi bi-folder-symlink me-3"></i>
                            Fixing a Runaway Node.js Recursive Folder Issue
                        </h1>
                        <h2 class="h3 mb-4">Resolving a program that creates endless recursive folders</h2>
                        <p class="lead mb-5">Node.js applications are generally efficient, but sometimes a bug can lead to unexpected consequences. This article explains how to handle a situation where a Node.js program creates thousands of nested directories that are nearly impossible to delete with standard tools.</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- Main Article Content-->
        <article id="main-article">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <!-- Table of Contents-->
                        <nav class="mb-5" id="table-of-contents" aria-label="Table of Contents">
                            <div class="card bg-light shadow-sm">
                                <div class="card-header">
                                    <h3 class="card-title mb-0 fw-bold">
                                        <i class="bi bi-list-ul me-2"></i>
                                        Table of Contents
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><a class="text-decoration-none" href="#problem">The Problem: Near-Infinite Recursive Folders</a></li>
                                        <li class="list-group-item"><a class="text-decoration-none" href="#windows-limitations">Long Path Support in Windows</a></li>
                                        <li class="list-group-item"><a class="text-decoration-none" href="#attempted-solutions">Steps Attempted Before Writing C++</a></li>
                                        <li class="list-group-item"><a class="text-decoration-none" href="#cpp-solution">Writing a C++ Program Solution</a></li>
                                        <li class="list-group-item"><a class="text-decoration-none" href="#code-explanation">Explanation of the C++ Code</a></li>
                                    </ul>
                                </div>
                            </div>
                        </nav>
                        <!-- Problem Section-->
                        <section class="mb-5" id="problem">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-danger text-white">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        The Problem: Near-Infinite Recursive Folders
                                    </h2>
                                </div>
                                <div class="card-body"><p class="mb-0">The issue began when a Node.js script, due to faulty logic, created recursive directories. Each iteration of the script added a new folder inside the previous one. This quickly grew into thousands of nested directories, becoming impossible to delete manually through Windows Explorer or Command Prompt due to the excessive depth of the folder structure.</p></div>
                            </div>
                        </section>
                        <!-- Windows Limitations Section-->
                        <section class="mb-5" id="windows-limitations">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-primary text-white">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-windows me-2"></i>
                                        Long Path Support in Windows
                                    </h2>
                                </div>
                                <div class="card-body">
                                    <p class="mb-4">Windows has a long-standing history of limitations with file path lengths. The default maximum length for paths is 260 characters, known as "MAX_PATH." By default, attempts to create or manipulate paths longer than this would fail. However, starting with Windows 10 (Anniversary Update), it became possible to enable long file path support by modifying the Group Policy or Windows Registry.</p>
                                    <div class="card mb-4 border-0 bg-light">
                                        <div class="card-header bg-secondary text-white"><h3 class="h5 mb-0">Enabling Long File Path Support</h3></div>
                                        <div class="card-body">
                                            <p class="mb-4">To enable support for longer paths, I did the following:</p>
                                            <div class="row mb-3">
                                                <div class="col-md-6">
                                                    <div class="card mb-3 h-100 border-0 bg-white">
                                                        <div class="card-header bg-info text-white">
                                                            <h4 class="h6 mb-0">
                                                                <i class="bi bi-gear me-2"></i>
                                                                Group Policy Editor Method
                                                            </h4>
                                                        </div>
                                                        <div class="card-body"><p class="mb-0">Navigated to "Computer Configuration > Administrative Templates > System > Filesystem" and enabled the "Enable Win32 long paths" policy.</p></div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card mb-3 h-100 border-0 bg-white">
                                                        <div class="card-header bg-info text-white">
                                                            <h4 class="h6 mb-0">
                                                                <i class="bi bi-braces me-2"></i>
                                                                Registry Edit Method
                                                            </h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <p class="mb-0">
                                                                As an alternative, I edited the Registry directly by setting the value of "LongPathsEnabled" in
                                                                <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem</code>
                                                                to
                                                                <code>1</code>
                                                                . This allowed support for file paths longer than 260 characters.
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-warning">
                                        <h4 class="alert-heading h5">
                                            <i class="bi bi-info-circle me-2"></i>
                                            Why Path Length is Important
                                        </h4>
                                        <p class="mb-0">Despite enabling long file path support, I still encountered limitations with other tools. The core issue was that many standard Windows utilities (such as Command Prompt and PowerShell) still had trouble handling long paths reliably, even with the new support. That's why a custom C++ solution, which directly interacts with the WIN32 API, became necessary.</p>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Attempted Solutions Section-->
                        <section class="mb-5" id="attempted-solutions">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-warning text-dark">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-tools me-2"></i>
                                        Steps Attempted Before Writing the C++ Program
                                    </h2>
                                </div>
                                <div class="card-body">
                                    <p class="mb-4">Initially, I tried using built-in tools like Windows Command Prompt and PowerShell, thinking I could delete the directories with a simple recursive command. Below are the tools I tried to use before concluding that I needed a custom solution:</p>
                                    <!-- Command Prompt Method-->
                                    <div class="card mb-4 border-0 bg-light">
                                        <div class="card-header bg-secondary text-white">
                                            <h3 class="h5 mb-0">
                                                <i class="bi bi-terminal me-2"></i>
                                                Windows Command Prompt
                                            </h3>
                                        </div>
                                        <div class="card-body">
                                            <p class="mb-3">The Windows Command Prompt is a simpler tool that lacks robust recursion and error-handling mechanisms. Commands like "rmdir" are not built to handle such complex directory structures and will often terminate with errors related to file path length or file locks.</p>
                                            <pre class="language-bash bg-dark text-light p-3 rounded"><code class="language-bash"><span class="token function">rmdir</span> /s <span class="token string">"C:\Your\Directory\Path"</span></code></pre>
                                            <p class="mb-0">Using the "rmdir /s" command, I attempted to remove the entire folder structure recursively. While this works well with normal directories, it failed in this case due to the extreme depth and length of the directory paths. Windows has limitations on path lengths, and this caused the command to fail with errors like "The file name is too long." or "The system cannot find the path specified." or just having the command shell close abruptly.</p>
                                        </div>
                                    </div>
                                    <!-- PowerShell Method-->
                                    <div class="card mb-4 border-0 bg-light">
                                        <div class="card-header bg-secondary text-white">
                                            <h3 class="h5 mb-0">
                                                <i class="bi bi-terminal-plus me-2"></i>
                                                PowerShell
                                            </h3>
                                        </div>
                                        <div class="card-body">
                                            <p class="mb-3">PowerShell is usually a robust tool for file management, but when dealing with an extremely large number of nested directories, it often fails due to the path length limitation and the recursion depth.</p>
                                            <p class="mb-3">I then tried using PowerShell with the "Remove-Item -Recurse -Force" command. PowerShell is a more powerful tool for managing files and directories, but it, too, failed due to the long file paths and the number of folders. PowerShell inherits the same file path limitations as the Command Prompt unless configured differently, so this option was insufficient.</p>
                                            <pre class="language-bash bg-dark text-light p-3 rounded"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-force</span> <span class="token string">"C:\Your\Directory\Path"</span></code></pre>
                                            <p class="mb-3">Though PowerShell had limitations in my case, a potential workaround could involve using the following script, which attempts to bypass the long path limitation by enabling long paths and splitting the process into smaller recursive chunks:</p>
                                            <pre class="language-bash bg-dark text-light p-3 rounded"><code class="language-bash">Remove-Item <span class="token parameter variable">-LiteralPath</span> <span class="token string">"C:\Your\Directory\Path"</span> <span class="token parameter variable">-Recurse</span> <span class="token parameter variable">-Force</span></code></pre>
                                            <p class="mb-0">This script could work for some, but in extreme cases like mine, where paths were excessively long and directories numbered in the thousands, it still fell short.</p>
                                        </div>
                                    </div>
                                    <!-- Additional Methods-->
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card mb-3 h-100 border-0 bg-light">
                                                <div class="card-header bg-secondary text-white">
                                                    <h3 class="h5 mb-0">
                                                        <i class="bi bi-ubuntu me-2"></i>
                                                        Bash Shell in VS Code
                                                    </h3>
                                                </div>
                                                <div class="card-body">
                                                    <p class="mb-3">While Linux systems generally handle file systems more gracefully, using Bash on WSL still relies on Windows' underlying file system. This means that although the Linux environment is more forgiving with paths, it inherits the limitations from Windows.</p>
                                                    <p class="mb-0">Linux systems handle long paths and recursive operations much more gracefully than Windows. I attempted to use Bash through VS Code to navigate and delete the directories. However, even though Linux could theoretically handle this depth of recursion, Bash failed due to Windows' underlying file system still imposing limits on path lengths.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card mb-3 h-100 border-0 bg-light">
                                                <div class="card-header bg-secondary text-white">
                                                    <h3 class="h5 mb-0">
                                                        <i class="bi bi-file-earmark-arrow-up me-2"></i>
                                                        Robocopy
                                                    </h3>
                                                </div>
                                                <div class="card-body"><p class="mb-0">Robocopy is a robust file copy utility built into Windows that can handle complex file operations. I attempted to use Robocopy to mirror an empty directory structure over the runaway directory, effectively overwriting it. However, Robocopy also failed due to the path length limitations, as it couldn't traverse the deep directory structure to delete the folders. I also tried to purge the directory using Robocopy, but it was unable to handle the excessive depth of the folder structure.</p></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-primary mt-3">
                                        <p class="mb-0">
                                            <strong>Conclusion:</strong>
                                            Ultimately, after trying all the built-in tools and existing solutions, I decided to write a C++ program that used the WIN32 API to delete directories recursively.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- C++ Solution Section-->
                        <section class="mb-5" id="cpp-solution">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-success text-white">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-code-square me-2"></i>
                                        Writing a C++ Program Solution
                                    </h2>
                                </div>
                                <div class="card-body">
                                    <p class="mb-4">Writing the custom C++ solution allowed me to bypass the limitations of standard Windows tools. The WIN32 API offers direct access to the underlying file system and can handle long paths effectively, provided the paths are prefixed with "\\\\?\\". This special prefix enables the API to handle file paths beyond the normal MAX_PATH limitation. By using the WIN32 API, I was able to traverse and delete directories without running into the typical errors caused by long paths.</p>
                                    <p class="mb-4">This program first collected all directories and files and then removed them from the deepest level up to the root, ensuring safe cleanup without getting errors for trying to delete a folder that has sub-folders.</p>
                                    <!-- Code with collapse button-->
                                    <div class="mb-4">
                                        <button class="btn btn-primary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#cppCode">
                                            <i class="bi bi-code-slash me-2"></i>
                                            Show/Hide C++ Code
                                        </button>
                                        <div class="collapse" id="cppCode">
                                            <pre class="language-csharp bg-dark text-light p-3 rounded"><code class="language-csharp"><span class="token preprocessor property">#include &lt;iostream></span>
<span class="token preprocessor property">#include &lt;windows.h></span>
<span class="token preprocessor property">#include &lt;string></span>
<span class="token preprocessor property">#include &lt;vector></span>
<span class="token preprocessor property">#include &lt;fstream></span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LogOperation</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token punctuation">::</span>wstring<span class="token operator">&amp;</span> message<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token punctuation">::</span>wstring<span class="token operator">&amp;</span> logFileName <span class="token operator">=</span> L<span class="token string">"operation_log.txt"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token punctuation">::</span><span class="token return-type class-name">wofstream</span> <span class="token function">logFile</span><span class="token punctuation">(</span>logFileName<span class="token punctuation">,</span> <span class="token named-parameter punctuation">std</span><span class="token punctuation">::</span>ios<span class="token punctuation">::</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>logFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logFile <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token punctuation">::</span>endl<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeleteDirectoryRecursively</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token punctuation">::</span>wstring<span class="token operator">&amp;</span> directory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  std<span class="token punctuation">::</span><span class="token class-name">vector<span class="token punctuation">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>wstring<span class="token punctuation">></span></span> directoriesToDelete<span class="token punctuation">;</span>
  std<span class="token punctuation">::</span><span class="token class-name">vector<span class="token punctuation">&lt;</span>std<span class="token punctuation">:</span><span class="token punctuation">:</span>wstring<span class="token punctuation">></span></span> allDirectories<span class="token punctuation">;</span>

  directoriesToDelete<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>directoriesToDelete<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token punctuation">::</span><span class="token class-name">wstring</span> currentDir <span class="token operator">=</span> directoriesToDelete<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    directoriesToDelete<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">WIN32_FIND_DATA</span> findFileData<span class="token punctuation">;</span>
    std<span class="token punctuation">::</span><span class="token class-name">wstring</span> searchPath <span class="token operator">=</span> currentDir <span class="token operator">+</span> L<span class="token string">"\\*"</span><span class="token punctuation">;</span>
    <span class="token class-name">HANDLE</span> hFind <span class="token operator">=</span> <span class="token function">FindFirstFile</span><span class="token punctuation">(</span>searchPath<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>findFileData<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>hFind <span class="token operator">!=</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> std<span class="token punctuation">::</span><span class="token class-name">wstring</span> fileOrDirName <span class="token operator">=</span> findFileData<span class="token punctuation">.</span>cFileName<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileOrDirName <span class="token operator">!=</span> L<span class="token string">"."</span> <span class="token operator">&amp;&amp;</span> fileOrDirName <span class="token operator">!=</span> L<span class="token string">".."</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> std<span class="token punctuation">::</span><span class="token class-name">wstring</span> fullPath <span class="token operator">=</span> currentDir <span class="token operator">+</span> L<span class="token string">"\\"</span> <span class="token operator">+</span> fileOrDirName<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>findFileData<span class="token punctuation">.</span>dwFileAttributes <span class="token operator">&amp;</span> FILE_ATTRIBUTE_DIRECTORY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            directoriesToDelete<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            allDirectories<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">SetFileAttributes</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FILE_ATTRIBUTE_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">DeleteFile</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">FindNextFile</span><span class="token punctuation">(</span>hFind<span class="token punctuation">,</span> <span class="token operator">&amp;</span>findFileData<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FindClose</span><span class="token punctuation">(</span>hFind<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  std<span class="token punctuation">::</span><span class="token function">reverse</span><span class="token punctuation">(</span>allDirectories<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> allDirectories<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token punctuation">::</span>wstring<span class="token operator">&amp;</span> dir <span class="token punctuation">:</span> allDirectories<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">RemoveDirectory</span><span class="token punctuation">(</span>dir<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">RemoveDirectory</span><span class="token punctuation">(</span>directory<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> std<span class="token punctuation">::</span><span class="token class-name">wstring</span> baseDirectory <span class="token operator">=</span> L<span class="token string">"\\\\?\\C:\\AzureDevOps\\runaway-node"</span><span class="token punctuation">;</span>
  <span class="token function">LogOperation</span><span class="token punctuation">(</span>L<span class="token string">"Starting directory delete process."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">DeleteDirectoryRecursively</span><span class="token punctuation">(</span>baseDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">LogOperation</span><span class="token punctuation">(</span>L<span class="token string">"Directory delete process completed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Code Explanation Section-->
                        <section class="mb-5" id="code-explanation">
                            <div class="card shadow-sm border-0">
                                <div class="card-header bg-info text-white">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-file-earmark-code me-2"></i>
                                        Explanation of the C++ Code
                                    </h2>
                                </div>
                                <div class="card-body">
                                    <p class="mb-4">This C++ code starts by scanning the directory provided (in this case, "C:\\AzureDevOps\\runaway-node") and collecting a list of all subdirectories. It does this recursively, storing all directories for later deletion. After collecting all the directories, it deletes them from the deepest folder up to the root directory.</p>
                                    <div class="card border-0 bg-light mb-4">
                                        <div class="card-body">
                                            <h3 class="h5">
                                                <i class="bi bi-list-check me-2"></i>
                                                Key Components of the Solution:
                                            </h3>
                                            <ol class="mb-0">
                                                <li class="mb-3">
                                                    <strong>Special Path Prefix:</strong>
                                                    The code uses "\\\\?\\" prefix before the path, which tells Windows to disable path parsing and bypass the 260-character limit.
                                                </li>
                                                <li class="mb-3">
                                                    <strong>Breadth-First Directory Collection:</strong>
                                                    The program uses a breadth-first approach to collect all directories that need to be deleted.
                                                </li>
                                                <li class="mb-3">
                                                    <strong>Reverse Deletion Order:</strong>
                                                    After collecting all directories, it reverses the order so that it deletes from the deepest nested folder first.
                                                </li>
                                                <li class="mb-3">
                                                    <strong>File Attribute Handling:</strong>
                                                    The code sets file attributes to normal before deletion, which helps overcome issues with read-only or hidden files.
                                                </li>
                                                <li>
                                                    <strong>Logging:</strong>
                                                    The program includes a logging function to track the progress and any potential issues during the deletion process.
                                                </li>
                                            </ol>
                                        </div>
                                    </div>
                                    <div class="alert alert-success">
                                        <h4 class="alert-heading h5">
                                            <i class="bi bi-check-circle me-2"></i>
                                            The Result
                                        </h4>
                                        <p class="mb-0">This C++ solution successfully deleted the thousands of nested directories that were created by the runaway Node.js script. It handled the long paths without issues and completed the cleanup in a reasonable amount of time. By working directly with the WIN32 API, the program was able to overcome the limitations of standard Windows tools and utilities.</p>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Final Section - Conclusion-->
                        <section class="mb-5" id="conclusion">
                            <div class="card border-primary shadow-sm">
                                <div class="card-header bg-primary text-white">
                                    <h2 class="h3 mb-0">
                                        <i class="bi bi-trophy me-2"></i>
                                        Key Takeaways
                                    </h2>
                                </div>
                                <div class="card-body">
                                    <p class="lead mb-4">When dealing with extremely deep directory structures in Windows, standard tools often fail due to path length limitations, even with modern settings enabled.</p>
                                    <div class="alert alert-success border-0 shadow-sm mb-4">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-star-fill text-success me-3 fs-4"></i>
                                            <div>
                                                <h4 class="alert-heading h6 mb-2">Prevention is Better Than Cure</h4>
                                                <p class="mb-0">Always test file system operations in your Node.js scripts, especially when they involve recursive directory creation or manipulation. Add appropriate validation and safeguards to prevent runaway processes.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="mb-0">For extreme cases where standard utilities fail, writing a custom solution using the WIN32 API with the "\\\\?\\" path prefix is the most reliable approach to handle long paths and deep directory structures in Windows.</p>
                                </div>
                            </div>
                        </section>
                        <!-- Back to Top Button-->
                        <div class="text-center mt-5">
                            <a class="btn btn-primary" href="#table-of-contents">
                                <i class="bi bi-arrow-up-circle me-2"></i>
                                Back to Table of Contents
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <!-- Auto-include floating LinkedIn share for article pages-->
        <!-- Check if first parameter is an article object-->
        <div class="floating-linkedin-share position-fixed" style="bottom: 20px; right: 20px; z-index: 1000">
            <a class="btn btn-linkedin btn-lg rounded-circle shadow" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmarkhazleton.com%2Farticles%2Ffixing-a-runaway-nodejs-recursive-folder-issue.html&amp;title=Fixing%20a%20Runaway%20Node.js%20Recursive%20Folder%20Issue&amp;summary=Learn%20how%20to%20resolve%20a%20Node.js%20bug%20that%20creates%20endless%20recursive%20directories%20and%20explore%20a%20C%2B%2B%20solution%20for%20efficient%20cleanup.&amp;source=Mark%20Hazleton" target="_blank" rel="noopener noreferrer" title="Share on LinkedIn" onclick="return openLinkedInShare(this.href);"><i class="fab fa-linkedin-in"></i></a>
        </div>
        <!-- Footer-->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <h5 class="mb-3">Mark Hazleton</h5>
                        <p class="text-light">Solutions Architect passionate for solutions which make technology work for business. Lifelong learner, not sidetracked by sizzle.</p>
                        <div class="social-icons">
                            <a href="https://www.linkedin.com/in/markhazleton/" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                            <a href="https://github.com/markhazleton/" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><i class="fab fa-github"></i></a>
                            <a href="https://www.youtube.com/@MarkHazleton" target="_blank" rel="noopener noreferrer" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <h6 class="mb-3">Quick Links</h6>
                        <ul class="list-unstyled footer-links">
                            <li><a href="/#about">About</a></li>
                            <li><a href="/#experience">Experience</a></li>
                            <li><a href="/#projects">Projects</a></li>
                            <li><a href="/articles.html">Articles</a></li>
                            <li><a href="/#contact">Contact</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 mb-4">
                        <h6 class="mb-3">Resources</h6>
                        <ul class="list-unstyled footer-links">
                            <li><a href="/projectmechanics/">Project Mechanics</a></li>
                            <li><a href="https://webspark.markhazleton.com">WebSpark</a></li>
                            <li><a href="/rss.xml">RSS Feed</a></li>
                            <li><a href="/sitemap.xml">Sitemap</a></li>
                        </ul>
                    </div>
                </div>
                <hr class="my-4" />
                <div class="row">
                    <div class="col-12 text-center"><p class="mb-0">&copy; 2025 Mark Hazleton. All rights reserved.</p></div>
                </div>
            </div>
        </footer>
        <script src="/js/scripts.js"></script>
    </body>
</html>
