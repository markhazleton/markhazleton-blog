<pre class="language-csharp"><code class="language-csharp"><span class="token operator">|</span>
<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Make1000RestCallsAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">|</span> <span class="token punctuation">{</span>
<span class="token operator">|</span> <span class="token comment">// Create a SemaphoreSlim with a maximum of 10 concurrent requests</span>
<span class="token operator">|</span> <span class="token class-name">SemaphoreSlim</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SemaphoreSlim</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">|</span>
<span class="token operator">|</span> <span class="token comment">// Create a list of tasks to make the 1000 REST calls</span>
<span class="token operator">|</span> List
<span class="token class-name">task</span>  tasks <span class="token operator">=</span> <span class="token keyword">new</span> List
  task
    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token comment">// Acquire the semaphore before making the request</span>
    <span class="token operator">|</span> <span class="token keyword">await</span> semaphore<span class="token punctuation">.</span><span class="token function">WaitAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>
    <span class="token operator">|</span> <span class="token comment">// Create a task to make the request</span>
    <span class="token operator">|</span> tasks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token keyword">try</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token comment">// Make the REST call</span>
    <span class="token operator">|</span> <span class="token keyword">await</span> <span class="token function">MakeRestCallAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token keyword">finally</span>
    <span class="token operator">|</span> <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token comment">// Release the semaphore</span>
    <span class="token operator">|</span> semaphore<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token punctuation">}</span>
    <span class="token operator">|</span>
    <span class="token operator">|</span> <span class="token comment">// Wait for all tasks to complete</span>
    <span class="token operator">|</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span>
    <span class="token operator">|</span> <span class="token comment">// Log a message when all calls are complete</span>
    <span class="token operator">|</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>All calls complete<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">|</span> <span class="token punctuation">}</span></code></pre>
