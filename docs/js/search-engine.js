/*!
* Start Bootstrap - Mark Hazleton Blog v9.0.2 (https://github.com/markhazleton/markhazleton-blog)
* Copyright 2013-2025 Mark Hazleton (https://markhazleton.com)
* Licensed under MIT (https://github.com/StartBootstrap/markhazleton-blog/blob/master/LICENSE)
*/
class ArticleSearchEngine{constructor(){this.articles=[],this.searchIndex=new Map,this.isLoaded=!1,this.currentResults=[],this.currentPage=1,this.itemsPerPage=10,this.currentQuery="",this.currentCategory=""}async init(){try{await this.loadArticles(),this.buildSearchIndex(),this.setupEventListeners(),this.handleUrlParameters(),this.isLoaded=!0,console.log("Search engine initialized with",this.articles.length,"articles")}catch(e){console.error("Failed to initialize search engine:",e),this.showError("Failed to load articles. Please try again.")}}async loadArticles(){const e=await fetch("/articles.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);this.articles=await e.json()}buildSearchIndex(){this.articles.forEach((e,t)=>{[e.name,e.description,e.keywords,e.Section,e.slug].join(" ").toLowerCase().split(/\s+/).forEach(e=>{(e=e.replace(/[^\w]/g,"")).length>2&&(this.searchIndex.has(e)||this.searchIndex.set(e,new Set),this.searchIndex.get(e).add(t))})})}setupEventListeners(){const e=document.getElementById("searchForm"),t=document.getElementById("searchInput"),s=document.getElementById("categoryFilter");if(e&&e.addEventListener("submit",e=>this.handleSearch(e)),t){let e;t.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>this.showSuggestions(),300)}),t.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),this.performSearch())})}s&&s.addEventListener("change",()=>{this.currentQuery&&this.performSearch()})}handleUrlParameters(){const e=new URLSearchParams(window.location.search),t=e.get("q"),s=e.get("category");if(t){const e=document.getElementById("searchInput");e&&(e.value=t),this.currentQuery=t}if(s){const e=document.getElementById("categoryFilter");e&&(e.value=s),this.currentCategory=s}(t||s)&&setTimeout(()=>this.performSearch(),100)}handleSearch(e){return e&&e.preventDefault(),this.performSearch(),!1}performSearch(){const e=performance.now(),t=document.getElementById("searchInput"),s=document.getElementById("categoryFilter");this.currentQuery=t?t.value.trim():"",this.currentCategory=s?s.value:"",this.currentPage=1,this.updateUrl(),this.currentResults=this.searchArticles(this.currentQuery,this.currentCategory),this.displayResults();const n=performance.now();this.updateSearchStats(this.currentResults.length,n-e),this.hideSuggestions()}searchArticles(e,t=""){let s=[...this.articles];if(t&&(s=s.filter(e=>e.Section===t)),!e)return s.sort((e,t)=>new Date(t.publishedDate)-new Date(e.publishedDate));const n=e.toLowerCase().split(/\s+/).filter(e=>e.length>0),r=[];return s.forEach(e=>{let t=0;[e.name,e.description,e.keywords,e.Section].join(" ").toLowerCase();n.forEach(s=>{e.name.toLowerCase().includes(s)&&(t+=10),e.description.toLowerCase().includes(s)&&(t+=5),e.keywords.toLowerCase().includes(s)&&(t+=7),e.Section.toLowerCase().includes(s)&&(t+=3),e.slug.toLowerCase().includes(s)&&(t+=4)}),t>0&&r.push({...e,searchScore:t})}),r.sort((e,t)=>t.searchScore!==e.searchScore?t.searchScore-e.searchScore:new Date(t.publishedDate)-new Date(e.publishedDate))}displayResults(){const e=document.getElementById("searchResults"),t=document.getElementById("loadingResults"),s=document.getElementById("noResults");if(!e)return;if(t&&t.classList.add("d-none"),e.innerHTML="",0===this.currentResults.length)return s&&s.classList.remove("d-none"),void this.hidePagination();s&&s.classList.add("d-none");const n=(this.currentPage-1)*this.itemsPerPage,r=n+this.itemsPerPage;this.currentResults.slice(n,r).forEach(t=>{const s=this.createResultCard(t);e.insertAdjacentHTML("beforeend",s)}),this.updatePagination()}createResultCard(e){const t=this.highlightSearchTerms(e.name,this.currentQuery),s=this.highlightSearchTerms(e.description,this.currentQuery),n=new Date(e.publishedDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return`\n            <div class="card mb-4 search-result-card">\n                <div class="card-body">\n                    <div class="row">\n                        <div class="col-md-8">\n                            <h5 class="card-title">\n                                <a href="/${e.slug}" class="text-decoration-none">\n                                    ${t}\n                                </a>\n                            </h5>\n                            <p class="card-text text-muted mb-2">${s}</p>\n                            <div class="d-flex flex-wrap align-items-center">\n                                <span class="badge bg-primary me-2 mb-1">${e.Section}</span>\n                                <small class="text-muted me-3 mb-1">\n                                    <i class="fas fa-calendar-alt me-1"></i>\n                                    ${n}\n                                </small>\n                                ${e.searchScore?`<small class="text-success mb-1">Relevance: ${e.searchScore}</small>`:""}\n                            </div>\n                        </div>\n                        <div class="col-md-4 text-md-end">\n                            <a href="/${e.slug}" class="btn btn-outline-primary btn-sm">\n                                Read Article\n                                <i class="fas fa-arrow-right ms-1"></i>\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}highlightSearchTerms(e,t){if(!t)return e;const s=t.split(/\s+/).filter(e=>e.length>0);let n=e;return s.forEach(e=>{const t=new RegExp(`(${this.escapeRegex(e)})`,"gi");n=n.replace(t,'<mark class="search-highlight">$1</mark>')}),n}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}showSuggestions(){const e=document.getElementById("searchInput");if(!e)return;const t=e.value.trim();if(t.length<2)return void this.hideSuggestions();const s=this.getSuggestions(t,5);if(0===s.length)return;let n='<div id="searchSuggestions" class="position-absolute bg-white border rounded shadow-sm mt-1 w-100" style="z-index: 1050;">';s.forEach(e=>{n+=`\n                <div class="suggestion-item p-3 border-bottom" onclick="searchEngine.selectSuggestion('${e.text}')" style="cursor: pointer;">\n                    <div class="fw-bold">${this.highlightSearchTerms(e.text,t)}</div>\n                    <small class="text-muted">${e.type} â€¢ ${e.count} articles</small>\n                </div>\n            `}),n+="</div>",this.hideSuggestions();const r=e.closest(".input-group").parentElement;r&&(r.style.position="relative",r.insertAdjacentHTML("beforeend",n))}getSuggestions(e,t){const s=[],n=new Set,r=e.toLowerCase();this.articles.forEach(e=>{e.name.toLowerCase().includes(r)&&!n.has(e.name)&&(s.push({text:e.name,type:"Article",count:1}),n.add(e.name))});return[...new Set(this.articles.map(e=>e.Section))].forEach(e=>{if(e.toLowerCase().includes(r)&&!n.has(e)){const t=this.articles.filter(t=>t.Section===e).length;s.push({text:e,type:"Category",count:t}),n.add(e)}}),s.slice(0,t)}selectSuggestion(e){const t=document.getElementById("searchInput");t&&(t.value=e,this.hideSuggestions(),this.performSearch())}hideSuggestions(){const e=document.getElementById("searchSuggestions");e&&e.remove()}updateSearchStats(e,t){const s=document.getElementById("searchStats"),n=document.getElementById("statsText"),r=document.getElementById("searchTime");if(s&&n&&r){s.classList.remove("d-none");let a=`Found ${e} article${1!==e?"s":""}`;this.currentQuery&&(a+=` for "${this.currentQuery}"`),this.currentCategory&&(a+=` in ${this.currentCategory}`),n.textContent=a,r.textContent=`Search completed in ${t.toFixed(2)}ms`}}updatePagination(){const e=document.getElementById("searchPagination");if(!e)return;const t=Math.ceil(this.currentResults.length/this.itemsPerPage);if(t<=1)return void e.classList.add("d-none");e.classList.remove("d-none");let s='<nav aria-label="Search results pagination"><ul class="pagination justify-content-center">';s+=`\n            <li class="page-item ${1===this.currentPage?"disabled":""}">\n                <a class="page-link" href="#" onclick="searchEngine.goToPage(${this.currentPage-1}); return false;" aria-label="Previous">\n                    <span aria-hidden="true">&laquo;</span>\n                </a>\n            </li>\n        `;const n=Math.max(1,this.currentPage-2),r=Math.min(t,this.currentPage+2);for(let e=n;e<=r;e++)s+=`\n                <li class="page-item ${e===this.currentPage?"active":""}">\n                    <a class="page-link" href="#" onclick="searchEngine.goToPage(${e}); return false;">${e}</a>\n                </li>\n            `;s+=`\n            <li class="page-item ${this.currentPage===t?"disabled":""}">\n                <a class="page-link" href="#" onclick="searchEngine.goToPage(${this.currentPage+1}); return false;" aria-label="Next">\n                    <span aria-hidden="true">&raquo;</span>\n                </a>\n            </li>\n        `,s+="</ul></nav>",e.innerHTML=s}goToPage(e){const t=Math.ceil(this.currentResults.length/this.itemsPerPage);if(e<1||e>t)return;this.currentPage=e,this.displayResults();const s=document.getElementById("searchResults");s&&s.scrollIntoView({behavior:"smooth",block:"start"})}hidePagination(){const e=document.getElementById("searchPagination");e&&e.classList.add("d-none")}updateUrl(){const e=new URLSearchParams;this.currentQuery&&e.set("q",this.currentQuery),this.currentCategory&&e.set("category",this.currentCategory);const t=`${window.location.pathname}${e.toString()?"?"+e.toString():""}`;window.history.replaceState({},"",t)}showError(e){const t=document.querySelector(".container");if(t){const s=`\n                <div class="alert alert-danger alert-dismissible fade show" role="alert">\n                    <i class="fas fa-exclamation-triangle me-2"></i>\n                    ${e}\n                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n                </div>\n            `;t.insertAdjacentHTML("afterbegin",s)}}}let searchEngine;window.performSearch=function(e){return e&&e.preventDefault(),searchEngine&&searchEngine.performSearch(),!1},document.addEventListener("DOMContentLoaded",async function(){document.getElementById("searchForm")&&(searchEngine=new ArticleSearchEngine,await searchEngine.init())}),document.addEventListener("click",function(e){searchEngine&&!e.target.closest(".input-group")&&searchEngine.hideSuggestions()});